template(name='tests')
    .ui.stackable.padded.grid
        .row
            .three.wide.column
                .ui.inline.center.aligned.big.header
                    |tests
                .ui.icon.large.circular.button.add_test(title='add test')
                    i.plus.large.icon
                .ui.fluid.green.large.circular.button.take_forest_test
                    i.right.chevron.large.icon
                +test_cloud
            .thirteen.wide.column
                .ui.segment
                    .ui.inline.header 
                        i.line.chart.icon
                        |stats
                    i.refresh.link.icon.refresh_user_stats
                    table.ui.definition.very.basic.table
                        thead
                            tr
                                th 
                                th avg.correct %
                                th total sessions
                                th avg duration (mins)
                                th avg mins/question
                                th sessions
                                //- each question_fields
                                //-     th #{title}
                        tbody
                                tr
                                    td you
                                    td #{currentUser.average_correct_percent}%
                                    td #{currentUser.total_session_amount} total sessions 
                                tr
                                    td global
                                    td #{gs.global_average_correct_percent}%
                                    td #{gs.total_sessions}
                div
                table.ui.celled.selectable.very.basic.table
                    thead
                        tr
                            th when
                            th 
                                i.green.checkmark.icon(title='correct answers')
                                i.orange.question.icon(title='almost correct (second guess)')
                                i.red.minus.icon(title='incorrect answers')
                                //- right/almost/wrong right%
                            th duration (mins)
                            th avg mins/question
                            th answers
                            //- each question_fields
                            //-     th #{title}
                    tbody
                        each test_sessions
                            tr.view_test
                                td #{when}
                                td 
                                    span.ui.green.text #{correct_count}
                                    spa.ui.grey.text &nbsp;
                                    span.ui.yellow.text #{almost_correct_count}
                                    spa.ui.grey.text &nbsp;
                                    span.ui.red.text #{incorrect_count}
                                    | =#{correct_percent}%
                                td #{minutes_duration}
                                td #{average_minutes_per_question}
                                td #{answer_count}
            
                //- .ui.stackable.five.cards
                //-     each tests
                //-         +test_card
        //- .row
        //-     .sixteen.wide.column
        //-         .ui.header test sessions
        //-         .ui.stackable.four.cards 
        //-             each test_sessions 
        //-                 .ui.card 
        //-                     .content
        //-                         a.ui.header(href="/test_session/#{_id}/view") #{when} #{_author_username}
        //-                         .ui.list
        //-                             .item #{question_count} total questions 
        //-                             .item #{answer_count} answered questions 
        //-                             .item #{correct_count} correct answers 
        //-                             .item #{incorrect_count} incorrect answers 
        //-                             .item #{almost_correct_count} almost correct count 
        //-                             .item #{correct_percent}% correct  
        //-                             .item #{minutes_duration} minutes duration
        //-                             .item #{average_question_duration} avg question duration

template(name='test_card')
    //- .ui.card    
    a.ui.card(href="/test/#{_id}/view")
        img.ui.fluid.image(src="{{c.url test_image_id width=400 height=200 crop='fill'}}")
        .content
            a.ui.header(href="/test/#{_id}/view") #{title}
            each tags
                .ui.basic.label #{this}
    
template(name='test_cloud')
    div
    //- #cloud
        //- .ui.left.icon.input
        //-     i.search.icon
        //-     +inputAutocomplete settings=settings id="search" class="" autocomplete="off" 
        // .ui.hidden.fitted.divider
    //- i.grey.tags.icon
    //- .ui.inline.header tags
    if selected_test_tags
        #clear_tags.ui.active.icon.button
            i.remove.icon
        each selected_test_tags
            .unselect_test_tag.ui.active.button
                strong #{this}
    each all_test_tags
        .ui.compact.button.select_test_tag(class=cloud_tag_class) 
            strong #{this.name}


                    


template(name='test_edit')
    with current_doc
        .ui.stackable.padded.grid
            .row
                .four.wide.column 
                    .ui.header 
                        i.pencil.icon
                        | edit '#{title}' test
                    a.ui.big.fluid.button(href="/test/#{_id}/view" title='save')
                        i.checkmark.large.icon
                        |save
                    +remove_button
                    +image_edit key='image_id' icon='image' label='image' direct=true
                    +array_edit key='tags' label='tags' icon='tags' direct=true
                .six.wide.column 
                    +text_edit key='title' direct=true
                    +html_edit key='description' label='description' icon='content' direct=true
                    unless generated 
                        .ui.button.add_question
                            i.plus.icon
                            |question
                        +question_lookup
                        each test_questions
                            .ui.header #{title}
                
                .six.wide.column 
                    +boolean_edit key='generated' label='generated' direct=true
                    if generated 
                        .ui.header generated
                        +array_edit key='theme_tags' label='theme tags' direct=true
                    .ui.divider
                    +boolean_edit key='timed' label='timed' direct=true
                    if timed 
                        +number_edit key='minute_duration' label='minutes' direct=true
                        .ui.divider




template(name='test_view')
    with current_doc
        .ui.stackable.padded.grid
            .row
                .four.wide.column   
                    a.ui.fluid.button(href="/tests")
                        i.chevron.left.icon
                        +i name='test' classes='ui inline mini image'
                        |tests
                    .ui.header test view 
                    +image_view key='test_image_id' label='image' direct=true
                    a.ui.fluid.button(href="/test/#{_id}/edit")
                        i.pencil.icon
                        |edit
                    i.tags.grey.icon
                    each tags
                        .ui.basic.label #{this}
                .twelve.wide.column
                    .ui.header #{title}
                    .ui.button.take_test 
                        |take test
                    .ui.header 
                        +i name='test'
                        |questions
                    .ui.header 
                        +i name='test'
                        |sessions
                    each sessions
                        .ui.header #{title}
                    +comments
                    
